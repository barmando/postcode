// Interactieve Postcode Zones Kaart
// ------------------------------------------------------------
// Hoe te gebruiken
// 1) Plaats dit bestand in je React/Vite/Next project als bijvoorbeeld PostcodeZonesMap.tsx
// 2) Installeer dependencies:
//    npm i react-leaflet leaflet
// 3) Voeg Leaflet CSS toe (bv. in src/main.tsx of _app.tsx):
//    import 'leaflet/dist/leaflet.css'
// 4) Gebruik de component: <PostcodeZonesMap />
// ------------------------------------------------------------

import { useMemo } from 'react'
import { MapContainer, TileLayer, Circle, Popup, useMap } from 'react-leaflet'
import type { LatLngExpression } from 'leaflet'

// Een klein helper-component om automatisch te zoomen zodat alle zones in beeld zijn
function FitAllBounds({ points }: { points: LatLngExpression[] }) {
  const map = useMap()
  useMemo(() => {
    if (!points.length) return
    const bounds = (points as [number, number][]) .reduce(
      (acc, [lat, lng]) => {
        acc[0][0] = Math.min(acc[0][0], lat)
        acc[0][1] = Math.min(acc[0][1], lng)
        acc[1][0] = Math.max(acc[1][0], lat)
        acc[1][1] = Math.max(acc[1][1], lng)
        return acc
      },
      [[90, 180], [-90, -180]] as [[number, number], [number, number]]
    )
    map.fitBounds(bounds as unknown as [[number, number],[number, number]], { padding: [40, 40] })
  }, [map, points])
  return null
}

// NB: "Loop op Zand" lijkt een typefout; hier gebruiken we "Loon op Zand". Pas gerust aan.
const ZONES = [
  {
    name: 'Altena',
    postcodes: ['4250–4255', '4260–4269', '4270–4273', '4280–4288'],
    center: [51.78, 4.94] as LatLngExpression, // regio Werkendam/Woudrichem
    radius: 14000, // meter (indicatieve zone)
    color: '#2563eb',
  },
  {
    name: 'Waalwijk',
    postcodes: ['5141–5149'],
    center: [51.69, 5.07] as LatLngExpression,
    radius: 7000,
    color: '#16a34a',
  },
  {
    name: 'Heusden',
    postcodes: ['5150–5154', '5250–5256'],
    center: [51.70, 5.17] as LatLngExpression, // Vlijmen/Drunen/Heusden
    radius: 9000,
    color: '#e11d48',
  },
  {
    name: 'Loon op Zand',
    postcodes: ['5170–5176'],
    center: [51.63, 5.07] as LatLngExpression,
    radius: 6000,
    color: '#9333ea',
  },
  {
    name: 'Dongen',
    postcodes: ['5100–5109'],
    center: [51.63, 4.94] as LatLngExpression,
    radius: 6000,
    color: '#f59e0b',
  },
]

export default function PostcodeZonesMap() {
  const points = ZONES.map(z => z.center)

  return (
    <div className="w-full h-[80vh] bg-white">
      <div className="absolute z-[1000] m-4 p-4 rounded-2xl shadow-lg bg-white/90 backdrop-blur border border-gray-200">
        <h1 className="text-xl font-semibold mb-1">Postcodezones</h1>
        <p className="text-sm text-gray-600 mb-2">Klik op een gekleurde zone voor details.</p>
        <ul className="text-sm space-y-1">
          {ZONES.map(z => (
            <li key={z.name} className="flex items-start gap-2">
              <span className="mt-1 inline-block h-3 w-3 rounded-full" style={{ backgroundColor: z.color }} />
              <span>
                <span className="font-medium">{z.name}:</span>{' '}
                {z.postcodes.join(', ')}
              </span>
            </li>
          ))}
        </ul>
      </div>

      <MapContainer
        className="h-full w-full rounded-none"
        center={[51.67, 5.02]}
        zoom={10}
        scrollWheelZoom
      >
        <TileLayer
          attribution='&copy; OpenStreetMap contributors'
          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
        />

        <FitAllBounds points={points} />

        {ZONES.map((z) => (
          <Circle
            key={z.name}
            center={z.center}
            radius={z.radius}
            pathOptions={{ color: z.color, fillColor: z.color, fillOpacity: 0.25 }}
          >
            <Popup>
              <div className="space-y-1">
                <div className="text-base font-semibold">{z.name}</div>
                <div className="text-sm text-gray-700">Postcodes: {z.postcodes.join(', ')}</div>
                <div className="text-xs text-gray-500">(Indicatieve zone voor visualisatie)</div>
              </div>
            </Popup>
          </Circle>
        ))}
      </MapContainer>

      <div className="absolute bottom-4 right-4 z-[1000] text-xs text-gray-600 bg-white/90 border border-gray-200 rounded-full px-3 py-1 shadow">
        © OpenStreetMap contributors
      </div>
    </div>
  )
}
